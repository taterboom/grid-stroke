!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("antd"),require("react-color")):"function"==typeof define&&define.amd?define(["react","antd","react-color"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).GridStroke=t(e.React,e.antd,e.ReactColor)}(this,(function(e,t,a){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e);var l=function(e){if(Array.isArray(e))return e};var o=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var a=[],r=!0,n=!1,l=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){n=!0,l=e}finally{try{r||null==c.return||c.return()}finally{if(n)throw l}}return a}};var c=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r};var i=function(e,t){if(e){if("string"==typeof e)return c(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?c(e,t):void 0}};var u=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var f,s=function(e,t){return l(e)||o(e,t)||i(e,t)||u()};function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=e.r,r=e.g,n=e.b,l=e.a;return 255===t&&(l*=255),[a,r,n,l]}function m(e,t,a,r,n,l,o){var c=s(t,4),i=c[0],u=c[1],m=c[2],h=c[3],g=s(a,4),p=g[0],E=g[1],b=g[2],y=g[3],T=d(r,255);if(i)for(var k=0;k<(u&&p?n+o:n);k++)v.call(this,f.TOP,e+4*k,T,l,o);if(u)for(var w=0;w<(m&&E?n+o:n);w++)v.call(this,f.RIGHT,e+4*l*w+4*n,T,l,o);if(m)for(var S=0;S<(h&&b?n+o:n);S++)v.call(this,f.BOTTOM,e+4*n*l+4*(n-S),T,l,o);if(h)for(var C=0;C<(i&&y?n+o:n);C++)v.call(this,f.LEFT,e+4*(n-C)*l,T,l,o)}function v(e,t,a,r,n){for(var l=0;l<n;l++)switch(e){case f.TOP:h.call(this,t-4*r*l,a);break;case f.RIGHT:h.call(this,t+4*l,a);break;case f.BOTTOM:h.call(this,t+4*r*l,a);break;case f.LEFT:h.call(this,t-4*l,a)}}function h(e,t){for(var a=0;a<t.length;a++)this[e+a]=t[a]}!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(f||(f={}));var g=function(e){var a=e.label,r=e.children;return n.default.createElement(t.Row,{gutter:[0,20]},n.default.createElement(t.Col,{span:6},a,":"),n.default.createElement(t.Col,{span:18},r))},p=200,E=n.default.forwardRef((function(t,a){var r=t.canvasSize,l=t.imgUrl,o=e.useRef(null),c=e.useState((function(){return{width:0,height:0}})),i=s(c,2),u=i[0],f=i[1],d=e.useState((function(){return{left:0,top:0}})),m=s(d,2),v=m[0],h=m[1];e.useEffect((function(){var e=o.current,t=function(){e&&f({width:e.offsetWidth||0,height:e.offsetHeight||0})},a=function(){e&&h({left:e.scrollLeft||0,top:e.scrollTop||0})};return t(),document.addEventListener("resize",t),e&&e.addEventListener("scroll",a),function(){document.removeEventListener("resize",t),e&&e.removeEventListener("scroll",a)}}),[]);var g=e.useMemo((function(){var e=p*u.width/r,t=p/r;return{width:e,height:e,left:v.left*t,top:v.top*t}}),[u,v,r]);return n.default.createElement("div",{className:"grid-stroke__canvas-contianer"},n.default.createElement("div",{ref:o,className:"grid-stroke__canvas"},n.default.createElement("canvas",{ref:a,width:r,height:r})),n.default.createElement("div",{className:"grid-stroke__map-container"},n.default.createElement("p",null,"Map："),n.default.createElement("div",{className:"grid-stroke__map",style:{width:p,height:p}},n.default.createElement("img",{src:l,alt:""}),n.default.createElement("div",{className:"grid-stroke__map-handler",style:g}))))}));return function(){var r=e.useState(!1),l=s(r,2),o=l[0],c=l[1],i=e.useState(""),u=s(i,2),f=u[0],v=u[1],h=e.useState(2016),p=s(h,2),b=p[0],y=p[1],T=e.useState(""),k=s(T,2),w=k[0],S=k[1],C=e.useState(16),O=s(C,2),R=O[0],L=O[1],_=e.useState({r:0,g:0,b:0,a:1}),I=s(_,2),P=I[0],U=I[1],M=e.useState(1),N=s(M,2),j=N[0],x=(N[1],e.useState({r:0,g:0,b:0,a:1})),A=s(x,2),B=A[0],D=A[1],F=e.useRef(null),G=e.useCallback((function(e){var t;return(t=e,new Promise((function(e,a){var r=new FileReader;r.addEventListener("load",(function(){return e(r.result+"")})),r.readAsDataURL(t)}))).then(S),!1}),[]);e.useEffect((function(){var e;w&&(e=w,new Promise((function(t,a){var r=new Image;r.onload=function(){t(r)},r.src=e}))).then((function(e){if(console.log(e),null!==F.current){var t=F.current,a=t.width,r=t.height,n=F.current.getContext("2d");if(null===n)return;n.clearRect(0,0,a,r),n.drawImage(e,0,0);var l=d(P),o="rgba(".concat(l.join(", "),")");console.log(o),n.strokeStyle=o;for(var c=R;c<a;c+=R)n.beginPath(),n.moveTo(0,c+.5),n.lineTo(a,c+.5),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(c+.5,0),n.lineTo(c+.5,r),n.closePath(),n.stroke();for(var i=n.getImageData(0,0,a,r),u=i.data,f=a%R*4||4*R,s=4*a-f,h=4*R;h<u.length;)h<4*a||parseInt(h/(4*a)+"")%R>0?(0===u[h-4+3]&&0===u[h+4+3]&&(u[h+3]=0),h+=h%(4*a)===s?f:4*R):((h%R==0&&0===u[h-4*a+3]&&0===u[h-4+3]&&0===u[h+4*(a+1)+3]||0===u[h-4*a+3]&&0===u[h+4*a+3])&&(u[h+3]=0),h+=4);for(var g=4*R;g<u.length;){if(0!==u[g+4*(a*R/2+R/2)+3]){var p=u[g-4*(a-R/2)+3],E=u[g-4*(a-R)+3],b=u[g+4*(R/2*a+R+1)+3],y=u[g+4*(R*a+R+1)+3],T=u[g+4*((R+1)*a+R/2)+3],k=u[g+(R+1)*a*4+3],w=u[g+4*(R/2*a-1)+3],S=u[g+4*(a-1)+3],C=[p,b,T,w].map((function(e){return 0===e||void 0===e})),O=[E,y,k,S].map((function(e){return 0===e||void 0===e}));m.call(u,g,C,O,B,R,a,j)}g+=g%(4*a)===s?f+4*(R-1)*a:4*R}n.putImageData(i,0,0),v(F.current.toDataURL("image/png"))}}))}),[w,R,b,P,j,B]);e.useCallback((function(e){L(e)}),[]);var H=e.useCallback((function(e){U(e.rgb)}),[]),z=(e.useCallback((function(e){D(e.rgb)}),[]),e.useCallback((function(e){y(e)}),[])),q=e.useCallback((function(){if(null!==F.current){var e=document.createElement("a");e.href=F.current.toDataURL("image/png"),e.download="test.png",e.click()}}),[]),V=e.useCallback((function(){null!==F.current&&(v(F.current.toDataURL("image/png")),c(!0))}),[]),W=e.useCallback((function(){c(!1)}),[]);return n.default.createElement("div",{className:"grid-stroke__container"},n.default.createElement(E,{ref:F,canvasSize:b,imgUrl:f}),n.default.createElement("div",{className:"grid-stroke__attr"},n.default.createElement(g,{label:"图片"},n.default.createElement(t.Upload,{listType:"picture-card",showUploadList:!1,beforeUpload:G},w?n.default.createElement("img",{src:w,style:{width:"100%"},alt:"pic"}):n.default.createElement("div",null,n.default.createElement("div",{className:"ant-upload-text"},"Upload")))),n.default.createElement(g,{label:"图片大小"},n.default.createElement(t.Select,{defaultValue:2016,style:{width:80},onChange:z},n.default.createElement(t.Select.Option,{value:504},"504"),n.default.createElement(t.Select.Option,{value:1008},"1008"),n.default.createElement(t.Select.Option,{value:2016},"2016"))),n.default.createElement(g,{label:"网格颜色"},n.default.createElement(a.ChromePicker,{color:P,onChange:H})),n.default.createElement(t.Button,{onClick:q},"导出"),n.default.createElement(t.Button,{onClick:V},"弹出图片手动保存"),n.default.createElement(t.Modal,{title:"长按或右击保存",visible:o,onOk:W,onCancel:W},n.default.createElement("div",{style:{width:"400px",height:"400px",overflow:"scroll",margin:"0 auto"}},n.default.createElement("img",{src:f,alt:""})))))}}));
